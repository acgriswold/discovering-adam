---
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro'
import BaseLayout from '../layouts/BaseLayout.astro'
import { useStoryblokApi } from '@storyblok/astro'

import '../styles/global.css'

const { slug } = Astro.params
let storyblokSlug = slug ?? 'home'

const version = 'draft' 
let storyblokApi = useStoryblokApi()

let { data } = 
    await storyblokApi.get(`cdn/stories/${storyblokSlug}`, { version })
        .then(response => response)
        .catch(error => error.status == 404 
            ? storyblokApi.get(`cdn/stories/errors/404`, { version })
            : storyblokApi.get(`cdn/stories/errors/unhandled`, { version }))

const story = data.story
---

<BaseLayout>
    <StoryblokComponent blok={story.content} />
</BaseLayout>
